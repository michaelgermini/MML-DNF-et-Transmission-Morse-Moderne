# 4.1 Cartographie HTML → MML : Transformation sémantique

## Le défi de la traduction inter-formats

### HTML : La syntaxe au service de la présentation

Le HTML moderne est conçu pour le **rendu visuel** plutôt que pour la transmission de données. Considérons cette page web typique :

```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Guide de survie</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Guide de survie en forêt</h1>
        <nav>
            <ul>
                <li><a href="#intro">Introduction</a></li>
                <li><a href="#urgence">Urgences</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="intro">
            <h2>Introduction</h2>
            <p>Cette page présente les <strong>techniques essentielles</strong> de survie.</p>
            <img src="survival.jpg" alt="Équipement de survie" width="300">
        </section>

        <section id="urgence">
            <h2>Situations d'urgence</h2>
            <ul>
                <li>Trouver un abri</li>
                <li>Allumer un feu</li>
                <li>Signaler sa position</li>
            </ul>
        </section>
    </main>
</body>
</html>
```

**Problèmes pour la transmission** :
- **Verbosité** : 25+ lignes pour un contenu simple
- **Mélange préoccupations** : Structure + présentation + comportement
- **Dépendances externes** : CSS, JavaScript, images
- **Redondance** : Balises d'ouverture/fermeture

### MML : La sémantique comme essence

Notre objectif n'est pas de "convertir" le HTML, mais de **distiller son essence sémantique** :

```mml
#META[title="Guide de survie"][language="fr"]

#H1 Guide de survie en forêt

#SECTION[id="intro"]
  #H2 Introduction
  #P Cette page présente les #STRONG techniques essentielles de survie.
  #IMG[src="survival.jpg"][alt="Équipement de survie"][width="300"]

#SECTION[id="urgence"]
  #H2 Situations d'urgence
  #UL
    #LI Trouver un abri
    #LI Allumer un feu
    #LI Signaler sa position
```

**Transformation réussie** :
- **78% de réduction** de la taille
- **Préservation complète** de la structure sémantique
- **Élimination** des préoccupations de présentation
- **Optimisation** pour la transmission

## Mappings élément par élément

### Structure documentaire de base

#### Titres (`<h1>` à `<h6>` → `#H1` à `#H6`)

**Principe** : Conservation directe de la hiérarchie

```html
<h1>Titre principal</h1>
<h2>Sous-titre</h2>
<h3>Sous-sous-titre</h3>
```

```mml
#H1 Titre principal
#H2 Sous-titre
#H3 Sous-sous-titre
```

**Attributs préservés** :
- `id` : Identifiant unique
- `class` : Classes sémantiques (ignorées si purement stylistiques)

#### Paragraphes (`<p>` → `#P`)

**Principe** : Unité discursive élémentaire

```html
<p>Ceci est un <strong>paragraphe</strong> avec <em>emphase</em>.</p>
```

```mml
#P Ceci est un #STRONG paragraphe avec #EM emphase.
```

**Gestion du contenu mixte** :
- Texte brut : Préservé tel quel
- Éléments inline : Convertis récursivement
- Espaces et sauts de ligne : Normalisés

### Contenu textuel formaté

#### Emphasis (`<strong>`/`<b>` → `#STRONG`, `<em>`/`<i>` → `#EM`)

```html
<p>Texte <strong>important</strong> et <em>accentué</em>.</p>
```

```mml
#P Texte #STRONG important et #EM accentué.
```

**Distinction sémantique** :
- `#STRONG` : Importance ou urgence
- `#EM` : Accent ou stress

#### Code et citations (`<code>` → `#CODE`, `<blockquote>` → `#BLOCKQUOTE`)

```html
<p>Utilisez la fonction <code>print()</code> pour afficher du texte.</p>
<blockquote>
    <p>Citation importante</p>
</blockquote>
```

```mml
#P Utilisez la fonction #CODE print() pour afficher du texte.
#BLOCKQUOTE Citation importante
```

### Listes et énumérations

#### Listes non ordonnées (`<ul>`/`<li>` → `#UL`/`#LI`)

```html
<ul>
    <li>Premier élément</li>
    <li>Deuxième élément avec <strong>emphase</strong></li>
</ul>
```

```mml
#UL
  #LI Premier élément
  #LI Deuxième élément avec #STRONG emphase
```

#### Listes ordonnées (`<ol>`/`<li>` → `#OL`/`#LI`)

```html
<ol>
    <li value="1">Premier</li>
    <li value="2">Deuxième</li>
</ol>
```

```mml
#OL
  #LI[value="1"] Premier
  #LI[value="2"] Deuxième
```

**Attributs préservés** :
- `value` : Numéro spécifique
- `type` : Style de numérotation

#### Listes de définition (`<dl>`/`<dt>`/`<dd>` → `#DL`/`#DT`/`#DD`)

```html
<dl>
    <dt>HTML</dt>
    <dd>HyperText Markup Language</dd>
    <dt>CSS</dt>
    <dd>Cascading Style Sheets</dd>
</dl>
```

```mml
#DL
  #DT HTML
  #DD HyperText Markup Language
  #DT CSS
  #DD Cascading Style Sheets
```

### Liens et références

#### Liens hypertexte (`<a>` → `#LINK`)

```html
<a href="/contact" title="Page de contact" rel="nofollow">Contactez-nous</a>
```

```mml
#LINK[href="/contact"][title="Page de contact"][rel="nofollow"] Contactez-nous
```

**Attributs critiques** :
- `href` : URL cible (obligatoire)
- `title` : Info-bulle
- `rel` : Relation sémantique

#### Ancres (`<a name="...">` → `#ANCHOR`)

```html
<a name="section1"></a>
<h2>Section 1</h2>
```

```mml
#ANCHOR[name="section1"]
#H2 Section 1
```

### Médias et objets

#### Images (`<img>` → `#IMG`)

```html
<img src="photo.jpg" alt="Description" width="300" height="200" title="Photo">
```

```mml
#IMG[src="photo.jpg"][alt="Description"][width="300"][height="200"][title="Photo"]
```

**Attributs essentiels** :
- `src` : Source de l'image (obligatoire)
- `alt` : Description textuelle (obligatoire pour l'accessibilité)

#### Médias temporels (`<video>`/`<audio>` → `#VIDEO`/`#AUDIO`)

```html
<video src="movie.mp4" controls width="640" height="480">
    <source src="movie.webm" type="video/webm">
    <track kind="subtitles" src="subs.vtt">
</video>
```

```mml
#VIDEO[src="movie.mp4"][controls="true"][width="640"][height="480"]
  #SOURCE[src="movie.webm"][type="video/webm"]
  #TRACK[kind="subtitles"][src="subs.vtt"]
```

### Tableaux et données structurées

#### Tableaux (`<table>` et éléments associés → `#TABLE` et éléments)

```html
<table>
    <caption>Données mensuelles</caption>
    <thead>
        <tr>
            <th>Mois</th>
            <th>Ventes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Janvier</td>
            <td>15000</td>
        </tr>
    </tbody>
</table>
```

```mml
#TABLE[caption="Données mensuelles"]
  #THEAD
    #TR
      #TH Mois
      #TH Ventes
  #TBODY
    #TR
      #TD Janvier
      #TD 15000
```

### Formulaires et interaction

#### Éléments de formulaire (`<form>`, `<input>`, etc. → `#FORM`, `#INPUT`, etc.)

```html
<form action="/submit" method="post">
    <input type="text" name="username" placeholder="Nom" required>
    <textarea name="message" rows="4">Message</textarea>
    <button type="submit">Envoyer</button>
</form>
```

```mml
#FORM[action="/submit"][method="post"]
  #INPUT[type="text"][name="username"][placeholder="Nom"][required="true"]
  #TEXTAREA[name="message"][rows="4"] Message
  #BUTTON[type="submit"] Envoyer
```

## Gestion des éléments complexes

### Conteneurs sémantiques

#### Sections et articles (`<section>`/`<article>` → `#SECTION`/`#ARTICLE`)

```html
<section id="intro">
    <h2>Introduction</h2>
    <p>Contenu...</p>
</section>
```

```mml
#SECTION[id="intro"]
  #H2 Introduction
  #P Contenu...
```

#### Conteneurs génériques (`<div>` → `#DIV`)

```html
<div class="container">
    <h1>Titre</h1>
</div>
```

```mml
#DIV[class="container"]
  #H1 Titre
```

**Filtrage sémantique** : Seules les classes sémantiques significatives sont préservées.

### Métadonnées et en-tête

#### Métadonnées documentaires (`<head>` → `#META`)

```html
<head>
    <title>Mon titre</title>
    <meta name="description" content="Description">
    <meta name="author" content="Auteur">
</head>
```

```mml
#META[title="Mon titre"][description="Description"][author="Auteur"]
```

#### Informations temporelles (`<time>` → `#TIME`)

```html
<time datetime="2024-01-15T10:30:00">15 janvier 2024</time>
```

```mml
#TIME[datetime="2024-01-15T10:30:00"] 15 janvier 2024
```

## Stratégies de conversion avancées

### Nettoyage et optimisation

#### Suppression du superflu

**Éléments ignorés** (présentation pure) :
- `<style>` : Styles inline
- `<script>` : JavaScript
- Classes CSS purement stylistiques
- Commentaires HTML
- Éléments de mise en page (`<br>`, `<hr>`)

#### Fusion d'éléments

**Paragraphes consécutifs** :
```html
<p>Partie 1</p>
<p>Partie 2</p>
```

```mml
#P Partie 1 Partie 2  // Fusionnés si sémantiquement équivalent
```

### Gestion des attributs

#### Filtrage intelligent

**Attributs préservés** :
- Sémantiques : `id`, `title`, `alt`, `href`
- Fonctionnels : `src`, `action`, `method`, `type`
- Métadonnées : `datetime`, `value`

**Attributs filtrés** :
- Présentation : `style`, `class` (stylistique), `width`/`height` (si redimensionnable)
- Comportement : `onclick`, `onload`
- Accessibilité : Conservés si significatifs

#### Normalisation

**URLs relatives → absolues** :
```html
<a href="contact.html">Contact</a>
```

```mml
#LINK[href="/contact.html"] Contact  // Avec résolution de base URL
```

### Gestion du contenu textuel

#### Normalisation des espaces

```html
<p>Texte   avec   espaces   multiples</p>
```

```mml
#P Texte avec espaces multiples  // Normalisé à un espace
```

#### Gestion des entités HTML

```html
<p>Copyright &copy; 2024</p>
```

```mml
#P Copyright © 2024  // Décodage des entités
```

## Architecture du convertisseur

### Pipeline de conversion

```python
class HTMLToMMLConverter:
    def __init__(self):
        self.element_mappings = self.load_mappings()
        self.attribute_filters = self.load_filters()

    def convert(self, html_content, base_url=None):
        """
        Conversion HTML → MML complète
        """
        # Parsing HTML
        soup = BeautifulSoup(html_content, 'html.parser')

        # Extraction des métadonnées
        metadata = self.extract_metadata(soup)

        # Conversion récursive
        mml_elements = self.convert_element(soup.body or soup)

        # Optimisation
        optimized = self.optimize_mml(mml_elements)

        # Sérialisation
        return self.serialize_mml(metadata + optimized)

    def convert_element(self, element):
        """
        Conversion récursive d'un élément HTML
        """
        if element.name is None:  # Texte brut
            return element.string.strip()

        # Mapping de l'élément
        mml_tag = self.element_mappings.get(element.name, f'#DIV')

        # Conversion des attributs
        mml_attrs = self.convert_attributes(element.attrs)

        # Conversion récursive des enfants
        children = []
        for child in element.children:
            child_mml = self.convert_element(child)
            if child_mml:
                children.append(child_mml)

        return MMLElement(mml_tag, attrs=mml_attrs, children=children)
```

### Gestion des erreurs et edge cases

#### Contenu mal formé

**HTML invalide** :
```html
<p>Paragraphe non fermé
<div>Autre div
```

**Récupération MML** :
```mml
#P Paragraphe non fermé
#DIV Autre div
```

#### Éléments inconnus

**Éléments non standards** :
```html
<custom-element>Contenu</custom-element>
```

**Fallback MML** :
```mml
#DIV[class="custom-element"] Contenu
```

## Métriques de qualité de conversion

### Fidélité sémantique

- **Structure préservée** : 95%+ des éléments structurels convertis
- **Hiérarchie maintenue** : Relations parent-enfant conservées
- **Liens fonctionnels** : URLs résolues et préservées

### Efficacité de compression

- **Ratio moyen** : 60-80% de réduction de taille
- **Lisibilité préservée** : MML reste humainement lisible
- **Transmission optimisée** : Format adapté aux canaux étroits

### Performance

- **Temps de conversion** : < 100ms pour documents typiques
- **Utilisation mémoire** : Proportionnelle à la taille du document
- **Évolutivité** : Traitement streaming possible

## Conclusion : De la présentation à la transmission

La cartographie HTML→MML représente une **transcendance technologique** : nous abandonnons les contraintes du web moderne (présentation, interactivité, dépendances) pour embrasser les exigences de la transmission universelle (concision, robustesse, sémantique pure).

Cette transformation n'est pas une perte ; c'est une **distillation**. Comme l'alchimiste transforme le plomb en or, nous transformons le HTML verbeux en MML essentiel, préservant l'essence informationnelle tout en éliminant les scories de l'implémentation.

Le résultat n'est pas seulement un document plus petit ; c'est un document **libéré**, capable de voyager sur n'importe quel médium, de survivre à n'importe quelle dégradation, de communiquer dans n'importe quel contexte. Cette cartographie n'est pas une conversion ; c'est une **émancipation sémantique**.
