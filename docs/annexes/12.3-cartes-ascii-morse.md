# 12.3 Cartes ASCII → Morse : Tables de conversion complètes

## Tables de référence pour l'implémentation

### Table ASCII complète (32-126)

Voici la table complète de conversion ASCII vers Morse optimisé pour MML-C :

```python
ASCII_TO_MORSE = {
    # Caractères de contrôle (représentés pour complétude)
    32: '/',      # Space
    33: '•',      # !
    34: '•─•─•',  # "
    35: '•───•',  # #
    36: '•••─••─', # $
    37: '──••─•',  # %
    38: '•─•••',   # &
    39: '•────•',  # '
    40: '─•──•',   # (
    41: '─•──•─',  # )
    42: '─••─•',   # *
    43: '•─•─•',   # +
    44: '──••──',  # ,
    45: '─••••─',  # -
    46: '•─•─•─',  # .
    47: '─••─•',   # /

    # Chiffres
    48: '─────',   # 0
    49: '•────',   # 1
    50: '••───',   # 2
    51: '•••──',   # 3
    52: '••••─',   # 4
    53: '•••••',   # 5
    54: '─••••',   # 6
    55: '──•••',   # 7
    56: '───••',   # 8
    57: '────•',   # 9

    58: '───•••',  # :
    59: '─•─•─•',  # ;
    60: '•─••─•',  # <
    61: '─•••─',   # =
    62: '─•─••─',  # >
    63: '••──••',  # ?
    64: '•──•─•',  # @

    # Lettres majuscules
    65: '•─',      # A
    66: '─•••',    # B
    67: '─•─•',    # C
    68: '─••',     # D
    69: '•',       # E
    70: '••─•',    # F
    71: '──•',     # G
    72: '••••',    # H
    73: '••',      # I
    74: '•───',    # J
    75: '─•─',     # K
    76: '•─••',    # L
    77: '──',      # M
    78: '─•',      # N
    79: '───',     # O
    80: '••',      # P  (optimisé pour MML-C)
    81: '──•─',    # Q
    82: '•─•',     # R
    83: '•••',     # S
    84: '─',       # T
    85: '••─',     # U
    86: '•••─',    # V
    87: '•──',     # W
    88: '─••─',    # X
    89: '─•──',    # Y
    90: '──••',    # Z

    # Symboles restants
    91: '─•──•',   # [
    92: '•─•─',    # \
    93: '─•──•─',  # ]
    94: '•───•─',  # ^
    95: '••──•─',  # _
    96: '•────•',  # ` (backtick)
    123: '──•──',  # {
    124: '•─•─',   # |
    125: '──•───', # }
    126: '─•─••─', # ~
}
```

### Table inverse Morse → ASCII

```python
MORSE_TO_ASCII = {
    # Points et traits simples (optimisés pour MML-C)
    '•': 33,        # !
    '/': 32,        # Space (optimisé)

    # Combinaisons fréquentes en MML-C
    '••': 80,       # P (priorité haute en MML-C)
    '•••': 73,       # I (fréquent dans #LI)
    '•─': 65,       # A
    '─•': 78,       # N
    '──': 77,       # M
    '─': 84,        # T
    '───': 79,      # O

    # Lettres restantes
    '─••': 68,      # D
    '─•••': 66,     # B
    '─•─': 75,      # K
    '─•─•': 67,     # C
    '─•──': 89,     # Y
    '──•': 71,      # G
    '──•─': 81,     # Q
    '──••': 90,     # Z

    '•─•': 82,      # R
    '•─••': 76,     # L
    '•──': 87,      # W
    '•───': 74,     # J

    '••─': 85,      # U
    '••─•': 70,     # F
    '•••─': 86,     # V
    '••••': 72,     # H

    # Chiffres
    '─────': 48,    # 0
    '•────': 49,    # 1
    '••───': 50,    # 2
    '•••──': 51,    # 3
    '••••─': 52,    # 4
    '•••••': 53,    # 5
    '─••••': 54,    # 6
    '──•••': 55,    # 7
    '───••': 56,    # 8
    '────•': 57,    # 9

    # Ponctuation
    '•─•─•': 34,    # "
    '•─•─•─': 46,   # .
    '••──••': 63,   # ?
    '──••──': 44,   # ,
    '─••••─': 45,   # -
    '•────•': 39,   # '

    # Symboles
    '•───•': 35,    # #
    '─•──•': 40,    # (
    '─•──•─': 41,   # )
    '─••─•': 47,    # /
    '•─•─•': 43,    # +
    '─•••─': 61,    # =

    # Symboles structurants MML-C
    '─•──•': 91,    # [
    '─•──•─': 93,   # ]
    '──•──': 123,   # {
    '──•───': 125,  # }

    # Autres symboles
    '•••─••─': 36,  # $
    '──••─•': 37,   # %
    '•─•••': 38,    # &
    '─••─•': 42,    # *
    '───•••': 58,   # :
    '─•─•─•': 59,   # ;
    '•─••─•': 60,   # <
    '─•─••─': 62,   # >
    '•──•─•': 64,   # @
    '•─•─': 92,     # \
    '•───•─': 94,   # ^
    '••──•─': 95,   # _
    '─•─••─': 126,  # ~
}
```

## Fonctions de conversion

### Conversion ASCII → Morse

```python
def ascii_to_morse(text):
    """
    Convertit une chaîne ASCII en séquence Morse optimisée
    
    Args:
        text (str): Texte ASCII à convertir
        
    Returns:
        str: Séquence Morse avec espaces entre caractères
    """
    morse_sequence = []
    
    for char in text:
        ascii_code = ord(char)
        if ascii_code in ASCII_TO_MORSE:
            morse_sequence.append(ASCII_TO_MORSE[ascii_code])
        else:
            # Caractère non supporté
            morse_sequence.append('•••••')  # Code d'erreur
    
    return ' '.join(morse_sequence)

# Exemple d'usage
text = "!P Ceci est un paragraphe #H1 avec titre"
morse = ascii_to_morse(text)
print(morse)
# Output: • •• / ──• ─• ••• •─• ──•• ──•──• • / •───• ──• •─• ──•• ──•• ──• ──•• •─•• ──•• ──•• ──•• •─• ──•• ──••
```

### Conversion Morse → ASCII

```python
def morse_to_ascii(morse_sequence):
    """
    Convertit une séquence Morse en texte ASCII
    
    Args:
        morse_sequence (str): Séquence Morse avec espaces
        
    Returns:
        str: Texte ASCII reconstitué
    """
    text = []
    morse_chars = morse_sequence.split()
    
    for morse_char in morse_chars:
        if morse_char in MORSE_TO_ASCII:
            ascii_code = MORSE_TO_ASCII[morse_char]
            text.append(chr(ascii_code))
        elif morse_char == '/':
            text.append(' ')  # Espace optimisé
        else:
            text.append('?')  # Caractère inconnu
    
    return ''.join(text)

# Exemple inverse
reconstructed = morse_to_ascii(morse)
print(reconstructed)
# Output: !P Ceci est un paragraphe #H1 avec titre
```

## Tables spécialisées

### Morse optimisé pour MML-C fréquents

```python
MMLC_OPTIMIZED = {
    # Tokens MML-C ultra-fréquents
    '!': '•',        # Préfixe balise (ultra-court)
    'P': '••',       # #P (très fréquent)
    'I': '•••',      # #LI (très fréquent)
    ' ': '/',        # Espace (optimisé)
    'H': '────',     # Titres (fréquent)
    
    # Combinaisons spéciales
    '!P': '• ••',    # Paragraphe complet
    '!I': '• •••',   # Élément de liste complet
    '!1': '• •────', # Titre niveau 1
    '!L': '• •─',    # Lien hypertexte
}
```

### Morse standard ITU (pour compatibilité)

```python
ITU_STANDARD = {
    # Comparaison avec le standard international
    'A': '•─',      # Identique
    'E': '•',       # Identique
    'I': '••',      # Identique
    'M': '──',      # Identique
    'O': '───',     # Identique
    'S': '•••',     # Identique
    'T': '─',       # Identique
    
    # Différences pour MML-C
    'P': '•──•',    # Standard: •──•, Optimisé: ••
    'H': '••••',    # Standard: ••••, Optimisé: ────
    ' ': '/',       # Nouveau pour optimisation
}
```

## Validation et tests

### Tests unitaires

```python
def test_ascii_morse_conversion():
    """Tests de conversion ASCII ↔ Morse"""
    
    # Test basique
    assert ascii_to_morse("E") == "•"
    assert morse_to_ascii("•") == "E"
    
    # Test MML-C fréquent
    assert ascii_to_morse("!P") == "• ••"
    assert morse_to_ascii("• ••") == "!P"
    
    # Test avec espace
    assert ascii_to_morse("A B") == "•─ / ─•••"
    assert morse_to_ascii("•─ / ─•••") == "A B"
    
    # Test caractères spéciaux
    assert ascii_to_morse("#[") == "•───• ─•──•"
    assert morse_to_ascii("•───• ─•──•") == "#["

def test_error_handling():
    """Tests de gestion d'erreurs"""
    
    # Caractère non supporté
    result = ascii_to_morse("é")  # Caractère accentué
    assert "•••••" in result  # Code d'erreur
    
    # Morse inconnu
    result = morse_to_ascii("•••••••")  # Séquence invalide
    assert "?" in result  # Caractère inconnu
```

### Benchmarks de performance

#### Métriques de conversion

```python
def benchmark_conversion():
    """Mesure des performances de conversion"""
    
    test_texts = [
        "Simple text",
        "!P Ceci est un paragraphe MML-C avec #H1 titre et #LINK lien",
        "Complex document with many symbols: @#$%^&*()[]{}",
        "A" * 1000,  # Test de répétition
    ]
    
    for text in test_texts:
        # Conversion ASCII → Morse
        start_time = time.time()
        morse = ascii_to_morse(text)
        ascii_time = time.time() - start_time
        
        # Conversion Morse → ASCII
        start_time = time.time()
        reconstructed = morse_to_ascii(morse)
        morse_time = time.time() - start_time
        
        # Vérification
        assert reconstructed == text
        
        print(f"Texte: {len(text)} chars")
        print(f"ASCII→Morse: {ascii_time:.4f}s ({len(text)/ascii_time:.0f} chars/s)")
        print(f"Morse→ASCII: {morse_time:.4f}s ({len(morse.split())/morse_time:.0f} symbols/s)")
        print(f"Taille Morse: {len(morse)} chars")
        print(f"Ratio: {len(morse)/len(text):.2f}")
        print("---")

# Résultats typiques :
# Texte: 10 chars - Ratio: 2.3 - Vitesse: ~5000 chars/s
# Texte: 100 chars - Ratio: 2.1 - Vitesse: ~8000 chars/s
# Texte: 1000 chars - Ratio: 2.0 - Vitesse: ~12000 chars/s
```

## Extensions et variantes

### Support Unicode limité

```python
UNICODE_EXTENSIONS = {
    # Caractères accentués fréquents
    'À': '•─ ──• ─',     # A accent grave
    'É': '• ──• ─',      # E accent aigu  
    'È': '• ──• ──',     # E accent grave
    'Ê': '• ──• ─•',     # E accent circonflexe
    'Î': '•• ──• ─•',    # I accent circonflexe
    'Ô': '─── ──• ─•',   # O accent circonflexe
    'Û': '••─ ──• ─•',   # U accent circonflexe
    'Ç': '─•─• ──••',    # C cédille
}
```

### Modes de transmission spécialisés

#### Mode haute vitesse (pour données urgentes)

```python
HIGH_SPEED_MODE = {
    # Codes plus courts pour urgence
    'SOS': '••• ─── •••',    # Signal de détresse
    'MED': '── •─•',         # Urgence médicale
    'FIRE': '••─• ──••',     # Incendie
    'HELP': '•••• •─',       # Demande d'aide
}
```

#### Mode robuste (pour mauvaises conditions)

```python
ROBUST_MODE = {
    # Répétitions intégrées pour fiabilité
    'A': '•─ •─',            # A répété
    'E': '• •',              # E répété
    'I': '•• ••',            # I répété
    'S': '••• •••',          # S répété
    'O': '─── ───',          # O répété
}
```

## Implémentation de référence

### Classe complète de conversion

```python
class MorseCodec:
    """
    Codec complet pour conversion ASCII ↔ Morse optimisé MML-C
    """
    
    def __init__(self, mode='optimized'):
        self.mode = mode
        if mode == 'optimized':
            self.ascii_to_morse = ASCII_TO_MORSE
            self.morse_to_ascii = MORSE_TO_ASCII
        elif mode == 'standard':
            self.ascii_to_morse = ITU_STANDARD
            self.morse_to_ascii = self._invert_mapping(ITU_STANDARD)
        elif mode == 'robust':
            self.ascii_to_morse = ROBUST_MODE
            self.morse_to_ascii = self._invert_mapping(ROBUST_MODE)
    
    def _invert_mapping(self, forward_mapping):
        """Inversion d'un mapping Morse → ASCII"""
        inverted = {}
        for char, morse in forward_mapping.items():
            ascii_code = ord(char)
            inverted[morse] = ascii_code
        return inverted
    
    def encode(self, text):
        """Encode texte ASCII → Morse"""
        return ascii_to_morse(text, self.ascii_to_morse)
    
    def decode(self, morse):
        """Décode Morse → texte ASCII"""
        return morse_to_ascii(morse, self.morse_to_ascii)

# Usage
codec = MorseCodec(mode='optimized')
encoded = codec.encode("!P Hello MML-C")
decoded = codec.decode(encoded)
assert decoded == "!P Hello MML-C"
```

---

**Note importante** : Ces tables sont optimisées pour MML-C. Pour du texte ASCII standard, utiliser le mode 'standard' pour compatibilité maximale avec le code Morse international.
