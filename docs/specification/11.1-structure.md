# 11.1 Structure : Spécification formelle du langage MML

## Spécification RFC 0001 : Minimal Markup Language (MML)

### Statut de ce document

**Type** : Spécification technique  
**Version** : 1.0.0  
**Date** : 15 novembre 2025  
**Statut** : Standard proposé  
**Auteur** : Système DNF-MML-Morse  
**Langue** : Français (avec traductions disponibles)

### Résumé

Le Minimal Markup Language (MML) est un langage de balisage conçu pour la transmission de documents structurés dans des environnements à bande passante limitée. Cette spécification définit la syntaxe, la sémantique et les règles de conformité du langage MML.

### Table des matières

1. Introduction
2. Conventions terminologiques
3. Syntaxe de base
4. Éléments et attributs
5. Types de données
6. Règles de validation
7. Sécurité et intégrité
8. Extensions
9. Exemples
10. Références

## 1. Introduction

### 1.1 Objectif

Le MML est conçu pour résoudre les limitations des langages de balisage traditionnels (HTML, XML) dans les contextes de transmission contrainte :

- **Bande passante limitée** : Formats compacts et compressibles
- **Transmission robuste** : Résistance aux erreurs et corruptions
- **Lisibilité humaine** : Syntaxe intuitive et maintenable
- **Extensibilité** : Support des besoins futurs

### 1.2 Contexte d'usage

Le MML est optimisé pour les environnements suivants :

- **Transmission radio amateur** : CW, Packet, numérique
- **Réseaux mesh** : Bluetooth, LoRa, WiFi
- **Canaux à faible débit** : Satellite, télémesure
- **Stockage contraint** : Appareils embarqués

### 1.3 Compatibilité

Le MML est conçu pour être :

- **Ascendantement compatible** : Versions futures lisent l'existant
- **Transformatif** : Conversion aisée vers HTML, Markdown, etc.
- **Indépendant** : Pas de dépendances externes
- **Portable** : Implémentable sur toute plateforme

## 2. Conventions terminologiques

### 2.1 Niveau de conformité

Les termes clés pour indiquer le niveau d'exigence :

- **DOIT** (MUST) : Obligatoire, pas d'exception
- **DEVRAIT** (SHOULD) : Recommandé, exceptions justifiées
- **PEUT** (MAY) : Optionnel
- **NE DOIT PAS** (MUST NOT) : Interdit

### 2.2 Notations

**BNF étendue** :
```
::= définition
[optionnel] élément optionnel
{élément}* zéro ou plus
{élément}+ un ou plus
"chaîne" littéral
```

**Types de données** :
- `string` : Chaîne de caractères UTF-8
- `integer` : Nombre entier
- `boolean` : vrai/faux
- `id` : Identifiant unique
- `uri` : Uniform Resource Identifier

## 3. Syntaxe de base

### 3.1 Structure générale

Un document MML est une séquence d'éléments :

```
document ::= {élément}* fin_de_fichier
élément ::= balise [contenu] [attributs] [enfants]
```

### 3.2 Balises

**Syntaxe** :
```
balise ::= "#" identifiant
identifiant ::= [A-Z] { [A-Z0-9_] }* (longueur ≤ 8)
```

**Règles** :
- DOIT commencer par `#`
- DOIT utiliser uniquement lettres majuscules, chiffres et underscore
- NE DOIT PAS dépasser 8 caractères
- DOIT être unique dans le contexte

**Exemples valides** :
```
#H1 #P #UL #LI #DIV #META
```

### 3.3 Contenu

**Syntaxe** :
```
contenu ::= texte | chaîne_quotée | ε
texte ::= {caractère_sauf_réservé}*
chaîne_quotée ::= '"' {caractère_sauf_guillemet}* '"'
```

**Caractères réservés** :
- `#` : Début de balise
- `[` : Début d'attributs
- `]` : Fin d'attributs
- `{` : Début d'enfants
- `}` : Fin d'enfants
- `\n` : Saut de ligne (séparateur d'éléments)

**Échappement** :
```
caractère_échappé ::= "\" caractère_réservé
```

### 3.4 Attributs

**Syntaxe** :
```
attributs ::= "[" {attribut}* "]"
attribut ::= clé "=" valeur
clé ::= [a-z] { [a-z0-9_] }*
valeur ::= chaîne_quotée | nombre | identifiant
```

**Types de valeurs** :
- **Chaîne quotée** : `"valeur avec espaces"`
- **Nombre** : `123` ou `123.45`
- **Identifiant** : `valeur_sans_espaces`
- **Booléen** : `true` ou `false`

### 3.5 Enfants

**Syntaxe** :
```
enfants ::= "{" {élément}* "}" | bloc_indenté
bloc_indenté ::= "\n" "  " {élément}* (réduction d'indentation)
```

**Règles d'indentation** :
- DOIT utiliser exactement 2 espaces par niveau
- NE DOIT PAS mélanger espaces et tabulations
- DOIT être cohérent dans tout le document

## 4. Éléments et attributs

### 4.1 Éléments structurels

#### Titres hiérarchiques

```
#H1 [id="titre-principal"] Titre principal
#H2 [level="2"] Sous-titre
#H3 [class="important"] Titre mineur
```

**Attributs** :
- `id` : Identifiant unique (string)
- `class` : Classes CSS (string)
- `level` : Niveau numérique (integer)

#### Conteneurs

```
#SECTION [id="intro"] Introduction
  #H2 Présentation
  #P Contenu de la section

#DIV [class="container"]
  #P Contenu générique
```

#### Métadonnées

```
#META [title="Titre du document"] [author="Auteur"] [version="1.0"]
#META [language="fr"] [created="2024-01-15"] [license="MIT"]
```

### 4.2 Éléments de contenu

#### Texte formaté

```
#P Paragraphe normal
#STRONG Texte important
#EM Texte accentué
#CODE variable_name
#MARK terme_recherché
```

#### Liens et références

```
#LINK [href="/destination"] [title="Info-bulle"] Texte du lien
#IMG [src="image.jpg"] [alt="Description"] [width="300"]
#ANCHOR [name="point-reference"]
```

#### Listes

```
#UL Liste non ordonnée
  #LI Premier élément
  #LI [value="custom"] Deuxième élément

#OL [type="A"] Liste ordonnée
  #LI Premier point
  #LI Deuxième point

#DL Liste de définitions
  #DT Terme
  #DD Définition
```

### 4.3 Éléments spécialisés

#### Médias

```
#VIDEO [src="video.mp4"] [controls="true"]
  #SOURCE [src="video.webm"] [type="video/webm"]

#AUDIO [src="audio.mp3"] [autoplay="false"]
```

#### Formulaires

```
#FORM [action="/submit"] [method="post"]
  #INPUT [type="text"] [name="username"] [required="true"]
  #BUTTON [type="submit"] Envoyer
```

#### Tableaux

```
#TABLE [caption="Données"]
  #THEAD
    #TR
      #TH Colonne 1
      #TH Colonne 2
  #TBODY
    #TR
      #TD Valeur A
      #TD Valeur B
```

## 5. Types de données

### 5.1 Types primitifs

#### Chaîne de caractères (string)

**Syntaxe** : Séquence de caractères UTF-8
**Longueur** : 0 à 65535 caractères
**Encodage** : UTF-8 obligatoire
**Échappement** : Caractères réservés précédés de `\`

#### Nombre entier (integer)

**Syntaxe** : Séquence de chiffres avec signe optionnel
**Plage** : -2^31 à 2^31-1
**Représentation** : Décimale uniquement

#### Nombre décimal (float)

**Syntaxe** : `entier.partie_décimale`
**Précision** : IEEE 754 double précision
**Notation** : Point comme séparateur décimal

#### Booléen (boolean)

**Valeurs** : `true` ou `false`
**Représentation** : Chaîne de caractères

### 5.2 Types composites

#### Identifiant (id)

**Syntaxe** : `[a-zA-Z] { [a-zA-Z0-9_-] }*`
**Usage** : Attributs `id`, références
** Unicité** : DOIT être unique dans le document

#### URI (uri)

**Syntaxe** : Conformément à RFC 3986
**Schémas supportés** : `http`, `https`, `file`, `mailto`, relatif
**Résolution** : Base URL configurable

#### Date/heure (datetime)

**Format** : ISO 8601
**Exemple** : `2024-01-15T10:30:00Z`
**Fuseau** : UTC par défaut

## 6. Règles de validation

### 6.1 Validation syntaxique

#### Règles de base

1. **Balise valide** : DOIT commencer par `#` suivi d'un identifiant valide
2. **Attributs clos** : DOIT avoir crochets ouvrants et fermants
3. **Enfants clos** : DOIT avoir accolades ouvrantes et fermantes
4. **Indentation cohérente** : DOIT utiliser des espaces consistants

#### Validation automatique

**Implémentation de référence** :
```python
def validate_mml_syntax(document_text):
    """
    Validation syntaxique complète
    """
    parser = MMLParser()
    try:
        ast = parser.parse(document_text)
        return ValidationResult(valid=True, ast=ast)
    except SyntaxError as e:
        return ValidationResult(valid=False, error=str(e))
```

### 6.2 Validation sémantique

#### Règles structurelles

1. **Hiérarchie de titres** : Niveaux DOIVENT progresser logiquement
2. **Imbrication valide** : Éléments DOIVENT être correctement imbriqués
3. **Références résolues** : Liens DOIVENT pointer vers cibles existantes
4. **Types cohérents** : Attributs DOIVENT avoir des valeurs valides

#### Validation contextuelle

**Règles spécifiques par élément** :
- `#IMG` DOIT avoir un attribut `alt`
- `#LINK` DOIT avoir un attribut `href`
- `#TABLE` PEUT avoir un attribut `caption`
- `#FORM` DOIT avoir un attribut `action`

### 6.3 Niveaux de conformité

#### Conformité minimale (C0)

- Syntaxe correcte
- Structure de base valide
- Encodage UTF-8

#### Conformité standard (C1)

- C0 + sémantique valide
- Types de données corrects
- Références cohérentes

#### Conformité stricte (C2)

- C1 + optimisation maximale
- Aucune redondance
- Structure canonique

## 7. Sécurité et intégrité

### 7.1 Hash d'intégrité

**Attribut obligatoire** : `hash` pour les éléments critiques
**Algorithme** : Blake2b par défaut
**Format** : Hexadécimal, 16 caractères

### 7.2 Signatures

**Attribut optionnel** : `signature` pour authentification
**Algorithme** : Ed25519 recommandé
**Format** : Base64, 88 caractères

### 7.3 Chiffrement

**Support optionnel** : Chiffrement des éléments sensibles
**Algorithme** : AES-256-GCM
**Gestion des clés** : Externe au MML

## 8. Extensions

### 8.1 Mécanisme d'extension

**Préfixe d'extension** : `X` pour éléments expérimentaux
**Exemple** : `#XCHART` pour graphiques

### 8.2 Domaines spécialisés

**Préfixe de domaine** : Identifiant court + `:`
**Exemple** : `#MED:DIAGNOSIS` pour diagnostics médicaux

### 8.3 Compatibilité ascendante

**Règle** : Extensions DOIVENT être ignorées gracieusement par les parsers de base

## 9. Exemples

### 9.1 Document minimal

```
#META[title="Exemple minimal"]
#H1 Titre principal
#P Ceci est un paragraphe simple.
```

### 9.2 Document complexe

```
#META[title="Document complexe"][author="Auteur"]
#H1 Titre principal
#SECTION[id="intro"]
  #H2 Introduction
  #P Texte d'introduction avec #STRONG emphase et #LINK[href="/lien"] lien.
  #UL
    #LI Premier point
    #LI Deuxième point avec #CODE code
#SECTION[id="conclusion"]
  #H2 Conclusion
  #P Texte de conclusion.
```

## 10. Références

### 10.1 Normes externes

- [RFC 3986] : Uniform Resource Identifier (URI)
- [RFC 4648] : Base16, Base32, Base64 Data Encodings
- [ISO 8601] : Date and time format
- [Unicode 14.0] : Universal Character Set

### 10.2 Spécifications connexes

- [DNF Protocol] : Protocole de réseau distribué
- [MML-C Compression] : Spécification de compression
- [Morse Mapping] : Mapping MML vers Morse

### 10.3 Implémentations de référence

- [Python MML Library] : Bibliothèque de référence
- [DNF Client] : Client complet DNF-MML-Morse
- [MML Validator] : Outil de validation

---

**Copyright** : Ce document est dans le domaine public.  
**Feedback** : Commentaires bienvenus sur le dépôt officiel.  
**Historique des versions** : Voir le changelog du projet.
