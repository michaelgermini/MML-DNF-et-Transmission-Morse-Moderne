# 7.3 APRS / Packet : Transmission numérique structurée

## APRS et Packet Radio : Données structurées sur ondes radio

### Origines et contextes

#### APRS (Automatic Packet Reporting System)

Développé par Bob Bruninga (WB4APR) en 1992, APRS est un système de **télémesure numérique** utilisant le packet radio pour transmettre des informations de position, de statut et de messages. Initialement conçu pour la localisation de véhicules d'urgence, APRS s'est étendu à de nombreux usages.

#### Packet Radio

Le packet radio désigne la **transmission de paquets de données numériques** via radio amateur, utilisant des protocoles comme AX.25. C'est l'équivalent radio des paquets TCP/IP, permettant des communications numériques fiables.

Dans notre système DNF-MML, APRS et Packet Radio offrent des **canaux numériques haute fiabilité** pour la transmission de nos documents compressés.

## Architecture technique

### Protocole AX.25 (Packet Radio)

#### Structure des paquets

**Format AX.25** :
```
[Flag] [Adresse destination] [Adresse source] [Contrôle] [PID] [Info] [FCS] [Flag]
```

**Éléments clés** :
- **Flag** : 0x7E (délimateur de paquet)
- **Adresses** : Callsigns radioamateur (6-7 caractères)
- **Contrôle** : Type de paquet (I, S, U frames)
- **PID** : Protocol Identifier (0xF0 pour texte)
- **Info** : Données utiles (jusqu'à 256 octets)
- **FCS** : Frame Check Sequence (CRC-16)

#### Modes de transmission

**1200 bps AFSK** :
- **Fréquence audio** : 1200/2200 Hz
- **Modulation** : Audio Frequency Shift Keying
- **Bande passante** : ~1000 Hz
- **Portée** : 10-50 km selon puissance/antenne

**9600 bps GMSK** :
- **Débit plus élevé** : 9.6 kbps
- **Modulation** : Gaussian Minimum Shift Keying
- **Complexité** : Équipement spécialisé requis

### APRS : Système de télémesure

#### Types de paquets APRS

**Position reports** :
```
F5ABC-9>APRS:!4801.23N/00215.67E>000/000/A=001234 Mobile station
```

**Messages** :
```
F5ABC-9>APRS::DESTINAT :Hello World!{001
```

**Objets et items** :
```
F5ABC-9>APRS:)OBJET     !4801.23N/00215.67E)Objet stationnaire
```

**Télémesure** :
```
F5ABC-9>APRS:T#123,456,789,012,345,678,901,234,567,890,123,456,789
```

#### Infrastructure APRS

**Réseaux mondiaux** :
- **IGates** : Passerelles Internet-radio
- **Digipeaters** : Répéteurs numériques
- **APRS-IS** : Serveur central mondial
- **Coverage** : 30,000+ stations actives

## Intégration DNF-MML avec APRS/Packet

### Architecture d'intégration

#### Pipeline DNF → APRS/Packet

```python
class DNFPacketBridge:
    def __init__(self, tnc_interface, callsign):
        self.tnc = TNCInterface(tnc_interface)
        self.callsign = callsign
        self.packet_builder = AX25PacketBuilder()
        self.fragment_manager = DNFFragmentManager()

    def transmit_mml_document(self, mml_content, destination_callsign):
        """
        Transmission d'un document MML via packet radio
        """
        # Compression MML-C
        compressed = MMLCCompressor().compress(mml_content)

        # Fragmentation pour limites AX.25
        fragments = self.fragment_manager.create_packet_fragments(
            compressed,
            max_size=200  # octets (limite AX.25 pratique)
        )

        # Transmission de chaque fragment
        for fragment in fragments:
            packet = self.build_dnf_packet(fragment, destination_callsign)
            self.tnc.transmit_packet(packet)

        return len(fragments)
```

#### Construction des paquets DNF

```python
def build_dnf_packet(self, fragment, destination):
    """
    Construction d'un paquet AX.25 pour DNF
    """
    # En-tête DNF dans le champ Info
    dnf_header = f"DNF/{fragment.sequence}/{fragment.total}/{fragment.checksum}/"

    # Données MML-C
    payload = dnf_header + fragment.content

    # Construction du paquet AX.25
    packet = AX25Packet()
    packet.destination = destination
    packet.source = self.callsign
    packet.control = 0x03  # I-frame
    packet.pid = 0xF0      # Texte
    packet.info = payload.encode('ascii')
    packet.fcs = packet.calculate_fcs()

    return packet
```

### Formats spécialisés

#### Messages APRS pour DNF

**Format de base** :
```
SOURCE>APRS::DEST    :DNF/SEQ/TOTAL/CHK/CONTENT{ID
```

**Exemple réel** :
```
F5ABC-9>APRS::F6XYZ-1:DNF/1/3/A1B2/!1 Guide urgence{001
F5ABC-9>APRS::F6XYZ-1:DNF/2/3/C3D4/!P Contenu...{002
F5ABC-9>APRS::F6XYZ-1:DNF/3/3/E5F6/CHK F7G8{003
```

#### Paquets binaires Packet Radio

**Avantages du binaire** :
- **Efficacité** : Pas de conversion ASCII
- **Taille** : 256 octets maximum
- **Fiabilité** : Moins d'erreurs de transcodage

**Structure DNF binaire** :
```
[Magic: 0xDNF] [Version: 1 byte] [Type: 1 byte] [Seq: 2 bytes] [Total: 2 bytes] [Checksum: 4 bytes] [Data: variable]
```

## Performances et limitations

### Métriques Packet Radio

#### Débits effectifs

| Mode | Débit brut | Débit net | Portée typique |
|------|------------|-----------|----------------|
| 1200 bps AFSK | 1200 bps | 300-600 bps | 20-50 km |
| 9600 bps GMSK | 9600 bps | 2000-4000 bps | 10-30 km |
| APRS | Variable | 50-200 bps | Via réseau |

#### Overhead protocolaire

**AX.25 overhead** :
- **En-têtes** : 20-30 octets par paquet
- **Flags** : 2 octets
- **FCS** : 2 octets
- **Total** : ~25% d'overhead

**DNF overhead** :
- **En-tête** : 15-20 octets
- **Checksum** : 4 octets
- **Séquencement** : 4 octets

### Robustesse APRS

#### Réseau distribué

**Avantages** :
- **Redondance** : Multiples chemins possibles
- **Couverture** : 24/7 mondiale via Internet
- **Fiabilité** : Stockage et retransmission automatique

**Limitations** :
- **Dépendance Internet** : APRS-IS peut être indisponible
- **Latence** : Quelques minutes pour la diffusion mondiale
- **Taille limitée** : 67 caractères par message

## Applications pratiques dans DNF

### Télémesure et monitoring

#### Position et statut des nœuds

**Paquets APRS standard** :
```
F5ABC-9>APRS:!4801.23N/00215.67E>045/012/A=001234 DNF Node Active
```

**Intégration DNF** :
- **Position** : Localisation des nœuds réseau
- **Statut** : État batterie, connectivité
- **Capacité** : Bande passante disponible

### Transmission de données structurées

#### Documents complets via Packet

**Avantages pour MML-C** :
- **Taille** : Paquets jusqu'à 256 octets
- **Fiabilité** : Correction d'erreurs AX.25
- **Vitesse** : Plus rapide que CW pour gros volumes
- **Structure** : Données binaires préservées

#### Routage intelligent

```python
class PacketRouter:
    def route_dnf_packet(self, packet, network_topology):
        """
        Routage intelligent des paquets DNF
        """
        destination = packet.destination

        # Recherche du meilleur chemin
        best_path = self.find_optimal_path(
            self.current_location,
            destination,
            network_topology
        )

        # Transmission via digipeaters
        for hop in best_path:
            self.transmit_via_digipeater(packet, hop)

        return best_path
```

### Communications d'urgence

#### Réseaux d'urgence APRS

**Fonctionnalités critiques** :
- **Localisation** : Position des équipes de secours
- **Messages** : Coordination en temps réel
- **Télémesure** : État des ressources (carburant, matériel)
- **Beacon** : Signalisation automatique de position

#### Intégration avec DNF

**Messages d'urgence** :
```
F5ABC-9>APRS::ALL    :DNF/URGENT/!EMERGENCY Flood alert sector 7{URG
```

## Implémentation matérielle/logicielle

### Interfaces TNC (Terminal Node Controller)

#### TNC matériel traditionnel

**Kenwood TM-D710** :
- **Modes** : Packet 1200/9600 bps
- **APRS intégré** : Position et messages
- **Interface** : Serial/USB
- **Alimentation** : 12V, faible consommation

#### TNC logiciel moderne

**Dire Wolf** :
- **Open source** : Linux/Windows/Mac
- **Modes** : AX.25, APRS, 1200/9600 bps
- **Interface** : Soundcard ou SDR
- **Flexibilité** : Configuration avancée

#### Interface Python

```python
class DireWolfInterface:
    def __init__(self, audio_device='default'):
        self.audio = AudioInterface(audio_device)
        self.kiss = KISSProtocol()
        self.ax25 = AX25Encoder()

    def transmit_packet(self, packet):
        """
        Transmission via Dire Wolf
        """
        # Encodage AX.25
        ax25_frame = self.ax25.encode_packet(packet)

        # Encodage KISS
        kiss_frame = self.kiss.encode_frame(ax25_frame)

        # Modulation audio
        audio_signal = self.modulate_afsk(kiss_frame)

        # Transmission
        self.audio.play_signal(audio_signal)

    def receive_packets(self):
        """
        Réception de paquets
        """
        while True:
            # Capture audio
            audio_data = self.audio.record(duration=10)

            # Démodulation AFSK
            kiss_frames = self.demodulate_afsk(audio_data)

            # Décodage KISS → AX.25
            for kiss_frame in kiss_frames:
                ax25_frame = self.kiss.decode_frame(kiss_frame)
                packet = self.ax25.decode_packet(ax25_frame)

                # Traitement DNF
                if self.is_dnf_packet(packet):
                    self.process_dnf_packet(packet)
```

### Logiciels de contrôle

#### APRS Clients

**APRS.fi** :
- **Web** : Interface cartographique mondiale
- **Mobile** : Applications iOS/Android
- **API** : Accès programmatique

**YAAC** :
- **Open source** : Java-based
- **Fonctionnalités** : Cartes, messages, objets
- **Extension** : Plugins personnalisés

#### Intégration DNF

**Client DNF-APRS** :
```python
class DNFAPRSClient:
    def __init__(self, callsign, aprs_server='aprs.fi'):
        self.callsign = callsign
        self.aprs = APRSInterface(aprs_server)
        self.dnf_processor = DNFMessageProcessor()

    def send_dnf_message(self, content, destination):
        """
        Envoi d'un message DNF via APRS
        """
        # Formatage APRS
        aprs_message = f":{destination}:DNF/{content}"

        # Envoi
        self.aprs.send_message(aprs_message)

    def monitor_dnf_messages(self):
        """
        Surveillance des messages DNF entrants
        """
        for message in self.aprs.monitor_messages():
            if self.is_dnf_message(message):
                self.dnf_processor.process_message(message)
```

## Défis et optimisations

### Gestion de la congestion réseau

#### APRS-IS limitations

**Problèmes** :
- **Limite de débit** : 5 messages/minute par station
- **Taille limitée** : 67 caractères
- **Priorisation** : Messages système prioritaires

**Solutions** :
- **Fragmentation intelligente** : Respect des limites
- **Compression maximale** : MML-C Nano
- **Scheduling** : Éviter les périodes de pointe

### Interopérabilité

#### Multi-protocoles

**Passerelles automatiques** :
- **APRS ↔ Packet** : Conversion transparente
- **Packet ↔ CW** : Fallback en cas de panne numérique
- **APRS ↔ Internet** : Routage vers DNF-IP

### Sécurité et authentification

#### Validation des paquets

**Mesures de sécurité** :
- **Checksums** : Vérification d'intégrité
- **Signatures** : Authentification des sources
- **Chiffrement** : Protection des données sensibles

## Évolution et perspectives

### Nouvelles normes

#### APRS 2.0

**Améliorations envisagées** :
- **Paquets plus gros** : Contenu étendu
- **Compression native** : Réduction de bande passante
- **Sécurité** : Chiffrement intégré

#### Packet Radio haute vitesse

**Nouveaux modes** :
- **27 MHz Packet** : Bande 10m
- **6m Packet** : Bande VHF
- **23cm Packet** : Bande micro-ondes

### Intégration IoT

#### Capteurs APRS

**Applications** :
- **Météo** : Stations météo automatiques
- **Environnement** : Capteurs pollution/air
- **Infrastructure** : Monitoring des réseaux

## Conclusion : La puissance du numérique structuré

APRS et Packet Radio apportent au système DNF-MML une **dimension numérique robuste** et structurée. Là où CW offre la simplicité ultime et JS8Call la fiabilité faible signal, APRS/Packet fournit la **vitesse et la structure** nécessaires pour les communications de données complexes.

Cette trilogie de protocoles (CW, JS8Call, APRS/Packet) crée un écosystème de transmission complet, capable de s'adapter à toutes les situations : de l'urgence absolue avec CW, à la communication mondiale faible puissance avec JS8Call, jusqu'aux données structurées haute fiabilité avec APRS/Packet.

Dans notre monde de plus en plus dépendant des données, ces technologies radioamateur prouvent que la **résilience informationnelle** peut être atteinte même dans les environnements les plus hostiles.
